ENV_FILE=$(realpath ${SCRIPT_DIR}/docker-compose.env)
BASE_ENV_FILE=$(realpath ${SCRIPT_DIR}/docker-compose.base.env)
LOCAL_ENV_FILE=$(realpath ${SCRIPT_DIR}/docker-compose.local.env)

ENV_FILE_RELATIVE=$(realpath --relative-to=${SCRIPT_DIR}/.. ${ENV_FILE})
BASE_ENV_FILE_RELATIVE=$(realpath --relative-to=${SCRIPT_DIR}/.. ${BASE_ENV_FILE})
LOCAL_ENV_FILE_RELATIVE=$(realpath --relative-to=${SCRIPT_DIR}/.. ${LOCAL_ENV_FILE})

ensure_docker_compose_env() {
  if [ ! -e ${ENV_FILE} ]; then
    if [ ! -e ${LOCAL_ENV_FILE} ]; then
      fatal "Looks like you have not set up yet. Please run dx/setup"
    else
      log "ðŸ—„" "Creating ${ENV_FILE_RELATIVE} from ${LOCAL_ENV_FILE_RELATIVE} and ${BASE_ENV_FILE_RELATIVE}"
      echo "# This is generated - do not edit" > ${ENV_FILE}
      echo "#" >> ${ENV_FILE}
      echo "# To make changes for the project, edit ${BASE_ENV_FILE_RELATIVE}" >> ${ENV_FILE}
      echo "# To make changes for your computer, edit ${LOCAL_ENV_FILE_RELATIVE}" >> ${ENV_FILE}
      echo "# Delete this file after changing either of those" >> ${ENV_FILE}
      echo "#" >> ${ENV_FILE}
      echo "" >> ${ENV_FILE}
      cat ${BASE_ENV_FILE} >> ${ENV_FILE}
      cat ${LOCAL_ENV_FILE} | grep -v ^# >> ${ENV_FILE}
    fi
  fi
  . ${ENV_FILE}
}
# vim: ft=bash
